<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Task Manager</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Times New Roman', Times, serif;
      background: url('https://www.transparenttextures.com/patterns/diag-stripes-light.png'), linear-gradient(135deg, #ffffff, #e8eff1);
      background-size: 100%, cover;
      background-attachment: fixed;
      height: 100vh;
      position: relative;
    }
    .heading {
      text-align: center;
      color: white;
      font-size: 36px;
      font-weight: bold;
      padding: 30px 20px 10px 20px;
      background-color: rgba(0, 0, 128, 0.7);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      letter-spacing: 1px;
    }
    .container, .login-box {
      background-color: #ffffffcc;
      max-width: 900px;
      margin: 30px auto;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    input, select { width: 90%; padding: 5px; }
    button { padding: 6px 12px; margin-top: 8px; }
    .hidden { display: none; }
    .correct { color: green; font-weight: bold; }
    .incorrect { color: red; font-weight: bold; }
    .completed { background-color: #d4edda; }
    .reallocated { background-color: #f8d7da; }
    .pending { background-color: #fff3cd; }
    .verification-pending { background-color: #d1ecf1; }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="heading">FAISAL IHSAN & ASSOCIATES LLP</div>

  <div class="login-box" id="loginBox">
    <h2>Login</h2>
    <select id="loginUser">
      <option value="">-- Select User --</option>
      <option value="IHSAN">IHSAN (Task Allocator)</option>
      <option value="HAFEES">HAFEES</option>
      <option value="MUEES">MUEES</option>
      <option value="HISANA">HISANA</option>
      <option value="NEENA NESLIN">NEENA NESLIN</option>
      <option value="RINSHA">RINSHA</option>
      <option value="SHAHANA">SHAHANA</option>
      <option value="FIDHA">FIDHA</option>
    </select>
    <input type="password" id="allocatorPassword" class="hidden" placeholder="Enter Password" />
    <button onclick="login()">Login</button>
  </div>

  <div class="container hidden" id="taskManager">
    <h2>Task Manager</h2>
    <div id="allocatorControls" class="hidden">
      <select id="assignTo">
        <option value="">-- Assign Task To --</option>
        <option value="HAFEES">HAFEES</option>
        <option value="MUEES">MUEES</option>
        <option value="HISANA">HISANA</option>
        <option value="NEENA NESLIN">NEENA NESLIN</option>
        <option value="RINSHA">RINSHA</option>
        <option value="SHAHANA">SHAHANA</option>
        <option value="FIDHA">FIDHA</option>
      </select>
      <input type="text" id="newTask" placeholder="Enter task">
      <button onclick="addTask()">Assign Task</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Sl No.</th>
          <th>Assigned To</th>
          <th>Task</th>
          <th>Date</th>
          <th>Status</th>
          <th>Verification</th>
          <th>Reason</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="taskTableBody"></tbody>
    </table>

    <button onclick="logout()">Logout</button>
  </div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAp19XzD61y6c7-zM0ga81opz8qbabPuR4",
    authDomain: "task-manager-13bf5.firebaseapp.com",
    projectId: "task-manager-13bf5",
    storageBucket: "task-manager-13bf5.appspot.com",
    messagingSenderId: "713486818209",
    appId: "1:713486818209:web:2be0f90bcbc8b2f13c89e0",
    measurementId: "G-K5NWB2GM3K"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const allocatorPass = "admin123";
  let currentUser = null;

  function login() {
    const user = document.getElementById("loginUser").value;
    const passInput = document.getElementById("allocatorPassword");
    if (!user) return alert("Select user");

    if (user === "IHSAN") {
      if (passInput.classList.contains("hidden")) {
        passInput.classList.remove("hidden");
        return;
      }
      if (passInput.value !== allocatorPass) return alert("Wrong password");
      currentUser = { name: "IHSAN", isAllocator: true };
    } else {
      currentUser = { name: user, isAllocator: false };
    }

    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("taskManager").classList.remove("hidden");
    if (currentUser.isAllocator) document.getElementById("allocatorControls").classList.remove("hidden");

    db.collection("tasks").onSnapshot(() => renderTasks());
  }

  function logout() {
    currentUser = null;
    document.getElementById("loginBox").classList.remove("hidden");
    document.getElementById("taskManager").classList.add("hidden");
    document.getElementById("allocatorPassword").classList.add("hidden");
    document.getElementById("allocatorPassword").value = "";
  }

  async function addTask() {
    const person = document.getElementById("assignTo").value;
    const task = document.getElementById("newTask").value.trim();
    if (!person || !task) return;

    await db.collection("tasks").add({
      person, task,
      date: new Date().toLocaleDateString(),
      status: "PENDING",
      reason: "",
      verificationStatus: ""
    });

    document.getElementById("assignTo").value = "";
    document.getElementById("newTask").value = "";
  }

  async function saveTask(id, task) {
    await db.collection("tasks").doc(id).update(task);
  }

  async function deleteTask(id) {
    await db.collection("tasks").doc(id).delete();
  }

  async function renderTasks() {
    const tbody = document.getElementById("taskTableBody");
    tbody.innerHTML = "";

    const snapshot = await db.collection("tasks").get();
    const tasks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

    const visibleTasks = currentUser.isAllocator ? tasks : tasks.filter(t => t.person === currentUser.name);

    visibleTasks.forEach((task, index) => {
      const row = document.createElement("tr");
      let rowClass = "";
      if (task.status === "COMPLETED") rowClass = "completed";
      if (task.status === "REALLOCATED") rowClass = "reallocated";
      if (task.status === "PENDING") rowClass = "pending";
      if (task.status === "VERIFICATION PENDING") rowClass = "verification-pending";
      row.className = rowClass;

      row.innerHTML = `
        <td>${index + 1}</td>
        <td>${task.person}</td>
        <td>${task.task}</td>
        <td>${task.date}</td>
        <td>
          <select onchange="saveTask('${task.id}', { status: this.value })"
            ${currentUser.isAllocator || task.status === "COMPLETED" ? 'disabled' : ''}>
            <option value="PENDING" ${task.status === "PENDING" ? "selected" : ""}>PENDING</option>
            <option value="VERIFICATION PENDING" ${task.status === "VERIFICATION PENDING" ? "selected" : ""}>VERIFICATION PENDING</option>
            <option value="COMPLETED" ${task.status === "COMPLETED" ? "selected" : ""} disabled>COMPLETED</option>
            <option value="REALLOCATED" ${task.status === "REALLOCATED" ? "selected" : ""} disabled>REALLOCATED</option>
          </select>
        </td>
        <td>
          ${currentUser.isAllocator ? 
            `<select onchange="saveTask('${task.id}', { verificationStatus: this.value })"
              ${task.status === "PENDING" ? 'disabled' : ''}>
              <option value="">-- Select --</option>
              <option value="CORRECT" ${task.verificationStatus === "CORRECT" ? "selected" : ""}>✔ Correct</option>
              <option value="INCORRECT" ${task.verificationStatus === "INCORRECT" ? "selected" : ""}>❌ Incorrect</option>
            </select>` :
            (task.verificationStatus === "CORRECT" ? '<span class="correct">✔</span>' :
            task.verificationStatus === "INCORRECT" ? '<span class="incorrect">❌</span>' : "")
          }
        </td>
        <td><input type="text" value="${task.reason || ""}" onblur="saveTask('${task.id}', { reason: this.value })"></td>
        <td>${currentUser.isAllocator ? <button onclick="deleteTask('${task.id}')">Delete</button> : ""}</td>
      `;
      tbody.appendChild(row);
    });
  }
</script>

</body>
</html>
